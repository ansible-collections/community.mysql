---

- name: "{{ role_name }} | Setvars | Extract Podman/Docker Network Gateway"
  ansible.builtin.shell:
    cmd: ip route|grep default|awk '{print $3}'
  register: ip_route_output

- name: "{{ role_name }} | Setvars | Set Fact"
  ansible.builtin.set_fact:
    gateway_addr: "{{ ip_route_output.stdout }}"
    connector_name: >
      {{ lookup(
        'file',
        '/root/ansible_collections/community/mysql/tests/integration/connector'
      ) }}
    db_engine_version: >
      {{ lookup(
        'file',
        '/root/ansible_collections/community/mysql/tests/integration/db_engine_version'
      ) }}"

- name: "{{ role_name }} | Setvars | Set Fact using above facts"
  ansible.builtin.set_fact:
    connector_ver: "{{ connector_name.split('=')[2].strip() }}"
    db_engine: "{{ db_engine_version | split(':') | first }}"
    db_version: "{{ db_engine_version | split(':') | last }}"
    mysql_command: >-
      mysql
      -h{{ gateway_addr }}
      -P{{ mysql_primary_port }}
      -u{{ mysql_user }}
      -p{{ mysql_password }}
      --protocol=tcp
    mysql_command_wo_port: >-
      mysql
      -h{{ gateway_addr }}
      -u{{ mysql_user }}
      -p{{ mysql_password }}
      --protocol=tcp

- name: "{{ role_name }} | Setvars | Output test informations"
  ansible.builtin.debug:
    msg: >
      Connector name: {{ connector_name }},
      Connector version: {{ connector_ver }},
      db_engine: {{ db_engine }},
      db_version: {{ db_version }}
