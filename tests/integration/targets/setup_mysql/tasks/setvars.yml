---

- name: "{{ role_name }} | setvars | Extract Podman/Docker Network Gateway"
  ansible.builtin.shell:
    cmd: ip route|grep default|awk '{print $3}'
  register: ip_route_output

- name: "{{ role_name }} | setvars | Set Fact"
  ansible.builtin.set_fact:
    connector_name: "{{ connector.name.0 }}"
    gateway_addr: "{{ ip_route_output.stdout }}"
    db_engine: "{{ db_engine_version | split(':') | first }}"
    db_version: "{{ db_engine_version | split(':') | last }}"

- name: "{{ role_name }} | setvars | Set Fact using above facts"
  ansible.builtin.set_fact:
    connector_ver: "{{ connector_name.split('=')[2].strip() }}"
    mysql_command: >
      mysql
      -h{{ gateway_addr }}
      -P{{ mysql_primary_port }}
      -u{{ mysql_user }}
      -p{{ mysql_password }}
      --protocol=tcp

- name: "{{ role_name }} | setvars | Debug connector info"
  ansible.builtin.debug:
    msg: >
      Connector name: {{ connector_name }},
      Connector version: {{ connector_ver }}
      db_engine: {{ db_engine }}
